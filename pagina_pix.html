<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Abraço Solidário</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <link rel="stylesheet" href="Style/pix.css">
</head>
<body>
    <header>
        <div class="banner">
           <img src="img/banner/menor.png" alt="Banner de doação">
    
           <div class="topo">
            <h1 class="logo"><a href="index.html">Abraço Solidário</a></h1>
               <nav class="menu">
                   <ul>
                    <li><a href="index.html">Nosso trabalho</a></li>
                    <li><a href="index.html">Doar</a></li>
                    <li><a href="index.html">Instituições</a></li>
                    <li><a href="contato.html">Contato</a></li>
                    <li><a href="login.html">Login</a></li>
                   </ul>
               </nav>
           </div>
        </div>
    </header>

    <div class="pix-content-wrapper">
        <div class="container">
            <h1>Pague com PIX</h1>
            <p>Use o QR Code ou a chave Copia e Cola abaixo.</p>

            <div class="info-box">
                <p>Destino: <strong id="instituicao-destino"></strong></p>
                <p>Valor: <strong id="valor-doacao"></strong></p>
            </div>

            <div id="qrcode"></div>
            
            <div id="cronometro-pix">00:10</div>
            
            <p style="font-size: 0.9em; color: #777;">
                Você tem 10 segundos para realizar o pagamento.
            </p>

            <div class="pix-key-container">
                <div id="chave-pix-copia">chave.pix.aleatoria@email.com</div>
                <button class="copy-button" id="copy-pix-button">Copiar</button>
            </div>
            <button onclick="window.location.href='index.html'" class="botao-principal">Voltar ao início</button>
        </div>
    </div>

    <script>
        // Função utilitária para gerar uma chave PIX simulada (email/telefone)
        function gerarChavePixAleatoria() {
            const tipo = Math.random() > 0.5 ? 'email' : 'telefone';
            if (tipo === 'email') {
                return 'abraco.solidario' + Math.floor(Math.random() * 999) + '@ong.org.br';
            } else {
                // Simula um telefone (Ex: 11987654321)
                return '(' + Math.floor(Math.random() * 80 + 10) + ') 9' + Math.floor(Math.random() * 9000 + 1000) + '-' + Math.floor(Math.random() * 9000 + 1000);
            }
        }
        
        // Função principal do JavaScript
        document.addEventListener('DOMContentLoaded', () => {
            // --- Variáveis Globais do Cronômetro ---
            let tempoRestante = 10; 
            const elementoCronometro = document.getElementById('cronometro-pix');
            
            // 1. Geração e Exibição da Chave PIX
            const chavePix = gerarChavePixAleatoria();
            document.getElementById('chave-pix-copia').textContent = chavePix;
            
            // 2. Lógica de Cópia
            const copyButton = document.getElementById('copy-pix-button');
            copyButton.addEventListener('click', () => {
                navigator.clipboard.writeText(chavePix).then(() => {
                    // Feedback visual temporário
                    copyButton.textContent = 'Copiado!';
                    copyButton.style.backgroundColor = '#4CAF50'; // Verde de sucesso
                    setTimeout(() => {
                        copyButton.textContent = 'Copiar';
                        // Retorna à cor do botão no CSS (78b3a7)
                        copyButton.style.backgroundColor = '#78b3a7'; 
                    }, 2000);
                }).catch(err => {
                    console.error('Erro ao copiar:', err);
                    alert('Erro ao copiar a chave PIX. Tente novamente.');
                });
            });
            
            // 3. Obter dados da URL e Exibir informações
            const urlParams = new URLSearchParams(window.location.search);
            const instituicao = urlParams.get('instituicao');
            const valor = urlParams.get('valor');

            document.getElementById('instituicao-destino').textContent = instituicao || 'Instituição Não Definida';
            
            let valorFormatado = "R$ 0,00";
            if (valor) {
                const valorNumerico = parseFloat(valor).toFixed(2).replace('.', ',');
                valorFormatado = `R$ ${valorNumerico}`;
            }
            document.getElementById('valor-doacao').textContent = valorFormatado;


            // 4. Gerar o "Código PIX" Aleatório para o QR Code (Mantido)
            const codigoPixAleatorio = `Doacao_${instituicao}_${valor}_${Math.random().toString(36).substring(2, 15)}_${new Date().getTime()}`;

            if (document.getElementById("qrcode")) {
                new QRCode(document.getElementById("qrcode"), {
                    text: codigoPixAleatorio,
                    width: 200,
                    height: 200,
                    colorDark : "#000000",
                    colorLight : "#ffffff",
                    correctLevel : QRCode.CorrectLevel.H
                });
            }

            // 5. Lógica do Cronômetro (Mantida)
            function atualizarCronometro() {
                const minutos = Math.floor(tempoRestante / 60);
                const segundos = tempoRestante % 60;

                const tempoFormatado = 
                    String(minutos).padStart(2, '0') + ':' + 
                    String(segundos).padStart(2, '0');

                elementoCronometro.textContent = tempoFormatado;

                if (tempoRestante <= 0) {
                    clearInterval(intervalo); 
                    localStorage.setItem('pixTimeOut', 'true'); 
                    window.location.href = 'index.html'; 
                }

                tempoRestante--;
            }

            const intervalo = setInterval(atualizarCronometro, 1000);

        });
    </script>

</body>
</html>